{% extends "base.html" %}

{% block title %}Dashboard - OpenManus Executive Assistant{% endblock %}

{% block extra_css %}
<style>
    body {
        background-color: #1a1d21;
        color: #e9ecef;
    }
    
    .sidebar {
        background-color: #1a1d21;
        border-right: 1px solid #2d3239;
        min-height: calc(100vh - 150px);
        position: fixed;
        width: 250px;
        top: 100px;
        z-index: 100;
    }
    
    .content-area {
        margin-left: 250px;
        padding: 20px;
    }
    
    .user-profile {
        padding: 20px;
        text-align: center;
        border-bottom: 1px solid #2d3239;
    }
    
    .user-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background-color: #7952b3;
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 36px;
        margin: 0 auto 15px;
    }
    
    .nav-menu {
        padding: 0;
    }
    
    .nav-menu .nav-item {
        list-style: none;
        padding: 0;
    }
    
    .nav-menu .nav-link {
        display: flex;
        align-items: center;
        padding: 12px 20px;
        color: #e9ecef;
        text-decoration: none;
        border-radius: 0;
        transition: background-color 0.3s;
    }
    
    .nav-menu .nav-link:hover {
        background-color: #2d3239;
    }
    
    .nav-menu .nav-link.active {
        background-color: #7952b3;
        color: white;
    }
    
    .nav-menu .nav-link i {
        margin-right: 10px;
        width: 24px;
        text-align: center;
    }
    
    .tab-content {
        background-color: #222529;
        border-radius: 10px;
        padding: 20px;
        margin-top: 20px;
    }
    
    .section-title {
        font-size: 24px;
        margin-bottom: 20px;
        font-weight: 600;
    }
    
    .card {
        background-color: #2d3239;
        border: none;
        border-radius: 10px;
        margin-bottom: 20px;
    }
    
    .card-header {
        background-color: #343a40;
        border-bottom: none;
        border-radius: 10px 10px 0 0 !important;
    }
    
    .btn-connect {
        background-color: #7952b3;
        border: none;
    }
    
    .btn-connect:hover {
        background-color: #6742a6;
    }
    
    .status-badge {
        padding: 5px 10px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 600;
    }
    
    .badge-connected {
        background-color: #28a745;
        color: white;
    }
    
    .badge-disconnected {
        background-color: #dc3545;
        color: white;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid p-0">
    <div class="row g-0">
        <!-- Sidebar -->
        <div class="col-auto">
            <div class="sidebar">
                <!-- User Profile -->
                <div class="user-profile">
                    <div class="user-avatar">
                        {{ current_user.username[0] | upper }}
                    </div>
                    <h4 class="mb-0">Welcome, {{ current_user.username }}</h4>
                    <p class="text-muted">{{ current_user.email }}</p>
                </div>
                
                <!-- Navigation Menu -->
                <ul class="nav-menu">
                    <li class="nav-item">
                        <a href="#overview" class="nav-link active" data-bs-toggle="tab">
                            <i class="bi bi-speedometer2"></i> Overview
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ url_for('chat') }}" class="nav-link">
                            <i class="bi bi-chat-dots"></i> Web Chat
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#services" class="nav-link" data-bs-toggle="tab">
                            <i class="bi bi-gear"></i> Connected Services
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#telegram" class="nav-link" data-bs-toggle="tab">
                            <i class="bi bi-telegram"></i> Telegram Bot
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#memory" class="nav-link" data-bs-toggle="tab">
                            <i class="bi bi-journal-text"></i> Memory Entries
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="#documents" class="nav-link" data-bs-toggle="tab">
                            <i class="bi bi-file-earmark-text"></i> Documents
                        </a>
                    </li>
                    <li class="nav-item mt-5">
                        <a href="#system-status" class="nav-link" data-bs-toggle="tab">
                            <i class="bi bi-gear-fill"></i> System Status
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Main Content Area -->
        <div class="col">
            <div class="content-area">
                <div class="tab-content">
                    <!-- Overview Tab -->
                    <div class="tab-pane fade show active" id="overview">
                        <h2 class="section-title">Dashboard Overview</h2>
                        <p class="lead">
                            Welcome to your OpenManus Executive Assistant. Here you can manage your connections and interact with your AI assistant.
                        </p>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <h5 class="card-title"><i class="bi bi-robot me-2"></i>Your AI Assistant</h5>
                                        <p class="card-text">
                                            Your assistant is powered by advanced AI capabilities and is ready to help you with tasks, information, and more.
                                        </p>
                                        <a href="{{ url_for('chat') }}" class="btn btn-primary">
                                            <i class="bi bi-chat-dots me-2"></i> Chat with DonnaH
                                        </a>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-body">
                                        <h5 class="card-title"><i class="bi bi-telegram me-2"></i>Telegram Access</h5>
                                        <p class="card-text">
                                            Connect your Telegram account to access your assistant from your mobile device anytime, anywhere.
                                        </p>
                                        <a href="#telegram" class="btn btn-primary" data-bs-toggle="tab">
                                            <i class="bi bi-telegram me-2"></i> Set Up Telegram
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-4">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h1 class="display-4">{{ memory_count|default(0) }}</h1>
                                        <p class="lead">Memory Entries</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center">
                                    <div class="card-body">
                                        <h1 class="display-4">{{ document_count|default(0) }}</h1>
                                        <p class="lead">Documents</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card text-center">
                                    <div class="card-body">
                                        {% set service_count = 0 %}
                                        {% if current_user.google_credentials %}
                                            {% set service_count = service_count + 1 %}
                                        {% endif %}
                                        {% if current_user.telegram_id %}
                                            {% set service_count = service_count + 1 %}
                                        {% endif %}
                                        <h1 class="display-4">{{ service_count }}/2</h1>
                                        <p class="lead">Connected Services</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Connected Services Tab -->
                    <div class="tab-pane fade" id="services">
                        <h2 class="section-title">Connected Services</h2>
                        <p class="lead">
                            Connect various services to enhance your assistant's capabilities and access to your data.
                        </p>
                        
                        <div class="row mt-4">
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="bi bi-google me-2"></i>Google Services</h5>
                                        {% if current_user.google_credentials %}
                                            <span class="status-badge badge-connected">Connected</span>
                                        {% else %}
                                            <span class="status-badge badge-disconnected">Not Connected</span>
                                        {% endif %}
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            Connect to access Gmail, Google Calendar, and Google Drive integration.
                                        </p>
                                        <ul class="list-group list-group-flush mb-3">
                                            <li class="list-group-item bg-transparent">
                                                <i class="bi bi-envelope me-2"></i> Gmail
                                            </li>
                                            <li class="list-group-item bg-transparent">
                                                <i class="bi bi-calendar3 me-2"></i> Google Calendar
                                            </li>
                                            <li class="list-group-item bg-transparent">
                                                <i class="bi bi-cloud me-2"></i> Google Drive
                                            </li>
                                        </ul>
                                        {% if current_user.google_credentials %}
                                            <a href="{{ url_for('google_auth.disconnect') }}" class="btn btn-outline-danger">
                                                <i class="bi bi-x-circle me-2"></i> Disconnect
                                            </a>
                                        {% else %}
                                            <a href="{{ url_for('google_auth.login') }}" class="btn btn-connect">
                                                <i class="bi bi-google me-2"></i> Connect Google Account
                                            </a>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card mb-4">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="bi bi-telegram me-2"></i>Telegram</h5>
                                        {% if current_user.telegram_id %}
                                            <span class="status-badge badge-connected">Connected</span>
                                        {% else %}
                                            <span class="status-badge badge-disconnected">Not Connected</span>
                                        {% endif %}
                                    </div>
                                    <div class="card-body">
                                        <p class="card-text">
                                            Access your assistant from Telegram for mobile conversations.
                                        </p>
                                        <p>
                                            {% if current_user.telegram_id %}
                                                Your Telegram account is connected to DonnaH.
                                            {% else %}
                                                Connect your Telegram account to access your assistant from your mobile device.
                                            {% endif %}
                                        </p>
                                        <a href="#telegram" class="btn btn-connect" data-bs-toggle="tab">
                                            <i class="bi bi-telegram me-2"></i> Configure Telegram
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Telegram Bot Tab -->
                    <div class="tab-pane fade" id="telegram">
                        <h2 class="section-title">Telegram Bot Integration</h2>
                        {% if current_user.telegram_id %}
                            <div class="alert alert-success">
                                <i class="bi bi-check-circle-fill me-2"></i>
                                Your Telegram account is connected to DonnaH.
                            </div>
                            <p>
                                You can chat with DonnaH on Telegram anytime. Open Telegram and search for <strong>@{{ bot_username }}</strong>.
                            </p>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5>Disconnect Telegram</h5>
                                </div>
                                <div class="card-body">
                                    <p>
                                        If you want to disconnect your Telegram account from DonnaH, you can do so below.
                                    </p>
                                    <form action="{{ url_for('reset_telegram_id', user_id=current_user.id) }}" method="post">
                                        <button type="submit" class="btn btn-danger">
                                            <i class="bi bi-x-circle me-2"></i> Disconnect Telegram
                                        </button>
                                    </form>
                                </div>
                            </div>
                        {% else %}
                            <p class="lead">
                                Connect to the Telegram bot to access your assistant from your mobile device.
                            </p>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5>Connect Your Telegram Account</h5>
                                </div>
                                <div class="card-body">
                                    <p>Follow these steps to connect your Telegram account:</p>
                                    <ol>
                                        <li>Open Telegram and search for <strong>@{{ bot_username }}</strong></li>
                                        <li>Start a conversation with the bot by clicking "Start"</li>
                                        <li>Send the following registration code to the bot:
                                            <div class="bg-dark p-2 mt-2 rounded">
                                                <code class="text-success">/register {{ registration_token }}</code>
                                            </div>
                                        </li>
                                    </ol>
                                    <p class="mt-3">
                                        <small class="text-muted">The registration code is valid for this session only and will expire when you log out.</small>
                                    </p>
                                </div>
                            </div>
                        {% endif %}
                        
                        {% if current_user.is_admin %}
                            <h3 class="mt-5">Admin: Bot Configuration</h3>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <h5>Webhook Status</h5>
                                        </div>
                                        <div class="card-body">
                                            <p>
                                                Webhook status: 
                                                {% if webhook_set %}
                                                    <span class="badge bg-success">Set</span>
                                                {% else %}
                                                    <span class="badge bg-danger">Not Set</span>
                                                {% endif %}
                                            </p>
                                            
                                            <div class="d-flex gap-2">
                                                <form action="{{ url_for('setup_telegram_webhook') }}" method="post">
                                                    <button type="submit" class="btn btn-success">
                                                        <i class="bi bi-check-circle me-2"></i> Set Webhook
                                                    </button>
                                                </form>
                                                
                                                <form action="{{ url_for('remove_telegram_webhook') }}" method="post">
                                                    <button type="submit" class="btn btn-danger">
                                                        <i class="bi bi-x-circle me-2"></i> Remove Webhook
                                                    </button>
                                                </form>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-6">
                                    <div class="card mb-4">
                                        <div class="card-header">
                                            <h5>Environment</h5>
                                        </div>
                                        <div class="card-body">
                                            <p>
                                                Current Environment: 
                                                <span class="badge {{ 'bg-primary' if token_info.environment == 'development' else 'bg-success' }}">
                                                    {{ token_info.environment|upper }}
                                                </span>
                                            </p>
                                            
                                            <p>
                                                Using Token: 
                                                <span class="badge {{ 'bg-primary' if not token_info.using_production_token else 'bg-success' }}">
                                                    {{ 'DEVELOPMENT' if not token_info.using_production_token else 'PRODUCTION' }}
                                                </span>
                                            </p>
                                            
                                            {% if not environment_token_match %}
                                                <div class="alert alert-warning">
                                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                                    Token doesn't match current environment. Consider switching tokens.
                                                </div>
                                            {% endif %}
                                            
                                            <form action="{{ url_for('switch_token') }}" method="post" class="mb-2">
                                                <button type="submit" class="btn btn-warning">
                                                    <i class="bi bi-arrow-repeat me-2"></i> 
                                                    Switch to {{ 'Production' if not token_info.using_production_token else 'Development' }} Token
                                                </button>
                                            </form>
                                            
                                            <form action="{{ url_for('switch_environment') }}" method="post">
                                                <button type="submit" class="btn btn-secondary">
                                                    <i class="bi bi-arrow-repeat me-2"></i> 
                                                    Switch to {{ 'Production' if token_info.environment == 'development' else 'Development' }} Environment
                                                </button>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="card mb-4">
                                <div class="card-header">
                                    <h5>Telegram Users</h5>
                                </div>
                                <div class="card-body">
                                    <p>Users with connected Telegram accounts:</p>
                                    
                                    {% if telegram_users|length > 0 %}
                                        <div class="table-responsive">
                                            <table class="table table-dark">
                                                <thead>
                                                    <tr>
                                                        <th>User</th>
                                                        <th>Email</th>
                                                        <th>Telegram ID</th>
                                                        <th>Actions</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    {% for user in telegram_users %}
                                                        <tr>
                                                            <td>{{ user.username }}</td>
                                                            <td>{{ user.email }}</td>
                                                            <td>{{ user.telegram_id }}</td>
                                                            <td>
                                                                <form action="{{ url_for('reset_telegram_id', user_id=user.id) }}" method="post">
                                                                    <button type="submit" class="btn btn-sm btn-danger">
                                                                        <i class="bi bi-x-circle"></i> Disconnect
                                                                    </button>
                                                                </form>
                                                            </td>
                                                        </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                    {% else %}
                                        <div class="alert alert-info">
                                            <i class="bi bi-info-circle-fill me-2"></i>
                                            No users have connected their Telegram accounts yet.
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Memory Entries Tab -->
                    <div class="tab-pane fade" id="memory">
                        <h2 class="section-title">Memory Entries</h2>
                        <p class="lead">
                            Browse and manage the information your assistant has stored for you.
                        </p>
                        
                        <div class="mb-3">
                            <input type="text" class="form-control" id="memory-search" placeholder="Search memories...">
                        </div>
                        
                        {% if memories|length > 0 %}
                            <div class="row row-cols-1 row-cols-md-2 g-4">
                                {% for memory in memories %}
                                    <div class="col memory-item">
                                        <div class="card h-100">
                                            <div class="card-header d-flex justify-content-between align-items-center">
                                                <h5 class="card-title mb-0">{{ memory.title }}</h5>
                                                <span class="badge bg-secondary">{{ memory.entry_type }}</span>
                                            </div>
                                            <div class="card-body">
                                                <p class="card-text">{{ memory.content|truncate(150) }}</p>
                                                <small class="text-muted">Added on {{ memory.created_at.strftime('%Y-%m-%d') }}</small>
                                            </div>
                                            <div class="card-footer bg-transparent">
                                                <button class="btn btn-sm btn-outline-info">View Details</button>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle-fill me-2"></i>
                                No memory entries found. As you interact with your assistant, it will store important information here.
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Documents Tab -->
                    <div class="tab-pane fade" id="documents">
                        <h2 class="section-title">Documents</h2>
                        <p class="lead">
                            Access and manage your documents integrated with the assistant.
                        </p>
                        
                        {% if documents|length > 0 %}
                            <div class="table-responsive">
                                <table class="table table-dark">
                                    <thead>
                                        <tr>
                                            <th>Title</th>
                                            <th>Type</th>
                                            <th>Last Updated</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for document in documents %}
                                            <tr>
                                                <td>{{ document.title }}</td>
                                                <td>{{ document.file_type }}</td>
                                                <td>{{ document.updated_at.strftime('%Y-%m-%d') }}</td>
                                                <td>
                                                    <button class="btn btn-sm btn-outline-info">View</button>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        {% else %}
                            <div class="alert alert-info">
                                <i class="bi bi-info-circle-fill me-2"></i>
                                No documents found. Connect Google Drive to access your documents or upload new ones.
                            </div>
                            
                            <div class="text-center mt-4">
                                {% if current_user.google_credentials %}
                                    <button class="btn btn-primary">
                                        <i class="bi bi-cloud-upload me-2"></i> Upload Document
                                    </button>
                                {% else %}
                                    <a href="{{ url_for('google_auth.login') }}" class="btn btn-connect">
                                        <i class="bi bi-google me-2"></i> Connect Google Drive
                                    </a>
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- System Status Tab -->
                    <div class="tab-pane fade" id="system-status">
                        <h2 class="section-title">System Status</h2>
                        <p class="lead">
                            Monitor the deployment status, configuration, and health of your OpenManus Assistant.
                        </p>
                        
                        <!-- Environment Badge -->
                        <div class="d-flex justify-content-between align-items-center mb-4">
                            <div>
                                <span class="badge {{ 'bg-primary' if token_info.environment == 'development' else 'bg-success' }} rounded-pill fs-6 p-2">
                                    <i class="bi bi-{{ 'tools' if token_info.environment == 'development' else 'globe' }} me-1"></i>
                                    {{ token_info.environment|upper }} Environment
                                </span>
                            </div>
                            <button class="btn btn-sm btn-outline-secondary" onclick="location.reload();">
                                <i class="bi bi-arrow-clockwise me-1"></i> Refresh
                            </button>
                        </div>
                        
                        <div class="row row-cols-1 row-cols-md-2 g-4 mb-4">
                            <!-- Environment Status -->
                            <div class="col">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="bi bi-globe me-2"></i>Environment</h5>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Environment:</span>
                                                <span class="badge {{ 'bg-primary' if token_info.environment == 'development' else 'bg-success' }}">{{ token_info.environment|upper }}</span>
                                            </li>
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Debug Mode:</span>
                                                <span class="badge {{ 'bg-warning' if debug_mode else 'bg-secondary' }}">{{ 'ENABLED' if debug_mode else 'DISABLED' }}</span>
                                            </li>
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Deployment Status:</span>
                                                <span class="badge {{ 'bg-primary' if not token_info.is_deployed else 'bg-success' }}">{{ 'DEVELOPMENT' if not token_info.is_deployed else 'DEPLOYED' }}</span>
                                            </li>
                                        </ul>
                                        
                                        {% if current_user.is_admin %}
                                            <div class="mt-3">
                                                <form action="{{ url_for('switch_environment') }}" method="post">
                                                    <button type="submit" class="btn btn-sm btn-warning">
                                                        <i class="bi bi-arrow-repeat me-1"></i> Switch Environment
                                                    </button>
                                                </form>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Telegram Bot Status -->
                            <div class="col">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="bi bi-telegram me-2"></i>Telegram Bot</h5>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Bot Active:</span>
                                                <span class="badge {{ 'bg-success' if bot_active else 'bg-danger' }}">{{ 'YES' if bot_active else 'NO' }}</span>
                                            </li>
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Using Token:</span>
                                                <span class="badge {{ 'bg-primary' if not token_info.using_production_token else 'bg-success' }}">{{ 'DEVELOPMENT' if not token_info.using_production_token else 'PRODUCTION' }}</span>
                                            </li>
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Webhook Set:</span>
                                                <span class="badge {{ 'bg-success' if webhook_set else 'bg-danger' }}">{{ 'YES' if webhook_set else 'NO' }}</span>
                                            </li>
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Token Matches Env:</span>
                                                <span class="badge {{ 'bg-success' if environment_token_match else 'bg-warning' }}">{{ 'YES' if environment_token_match else 'NO' }}</span>
                                            </li>
                                        </ul>
                                        
                                        {% if current_user.is_admin and not environment_token_match %}
                                            <div class="mt-3">
                                                <form action="{{ url_for('switch_token') }}" method="post">
                                                    <button type="submit" class="btn btn-sm btn-warning">
                                                        <i class="bi bi-arrow-repeat me-1"></i> Switch Token
                                                    </button>
                                                </form>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Database Status -->
                            <div class="col">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="bi bi-database me-2"></i>Database</h5>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Connected:</span>
                                                <span class="badge {{ 'bg-success' if db_connected else 'bg-danger' }}">{{ 'YES' if db_connected else 'NO' }}</span>
                                            </li>
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Database Type:</span>
                                                <span class="badge bg-info">{{ db_type }}</span>
                                            </li>
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>User Count:</span>
                                                <span class="badge bg-secondary">{{ user_count }}</span>
                                            </li>
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Memory Entries:</span>
                                                <span class="badge bg-secondary">{{ memory_count }}</span>
                                            </li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- OpenManus Status -->
                            <div class="col">
                                <div class="card h-100">
                                    <div class="card-header">
                                        <h5 class="mb-0"><i class="bi bi-robot me-2"></i>OpenManus</h5>
                                    </div>
                                    <div class="card-body">
                                        <ul class="list-group list-group-flush">
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Active:</span>
                                                <span class="badge {{ 'bg-success' if manus_active else 'bg-danger' }}">{{ 'YES' if manus_active else 'NO' }}</span>
                                            </li>
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>API Key:</span>
                                                <span class="badge {{ 'bg-success' if manus_api_key else 'bg-danger' }}">{{ 'PRESENT' if manus_api_key else 'MISSING' }}</span>
                                            </li>
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Memory System:</span>
                                                <span class="badge {{ 'bg-success' if memory_system_initialized else 'bg-warning' }}">{{ 'INITIALIZED' if memory_system_initialized else 'NOT READY' }}</span>
                                            </li>
                                            <li class="list-group-item bg-transparent d-flex justify-content-between">
                                                <span>Implementation:</span>
                                                <span class="badge bg-primary">{{ manus_impl }}</span>
                                            </li>
                                        </ul>
                                        
                                        {% if current_user.is_admin %}
                                            <div class="mt-3">
                                                <form action="{{ url_for('change_model') }}" method="post" class="d-flex gap-2">
                                                    <select name="model" class="form-select form-select-sm">
                                                        {% for model_id, model_name in available_models.items() %}
                                                            <option value="{{ model_id }}" {{ 'selected' if model_id == manus_model }}>{{ model_name }}</option>
                                                        {% endfor %}
                                                    </select>
                                                    <button type="submit" class="btn btn-sm btn-primary">
                                                        Change Model
                                                    </button>
                                                </form>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Environment Variables -->
                        <div class="card mb-4">
                            <div class="card-header">
                                <h5 class="mb-0"><i class="bi bi-key me-2"></i>Environment Variables</h5>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-dark">
                                        <thead>
                                            <tr>
                                                <th>Variable</th>
                                                <th>Status</th>
                                                <th>Value</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for var in env_vars %}
                                                <tr>
                                                    <td>{{ var.name }}</td>
                                                    <td>
                                                        <span class="badge {{ 'bg-success' if var.exists else 'bg-danger' }}">
                                                            {{ 'PRESENT' if var.exists else 'MISSING' }}
                                                        </span>
                                                    </td>
                                                    <td>
                                                        {% if var.is_secret and var.exists %}
                                                            <span class="text-muted">[Secret]</span>
                                                        {% elif var.exists and var.sample %}
                                                            {{ var.sample }}
                                                        {% elif var.exists %}
                                                            <span class="text-muted">[Set]</span>
                                                        {% else %}
                                                            <span class="text-muted">Not Set</span>
                                                        {% endif %}
                                                    </td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <!-- System Logs -->
                        <div class="card">
                            <div class="card-header d-flex justify-content-between align-items-center">
                                <h5 class="mb-0"><i class="bi bi-journal-text me-2"></i>Recent Logs</h5>
                                <button class="btn btn-sm btn-outline-secondary" id="refreshLogs">
                                    <i class="bi bi-arrow-clockwise me-1"></i> Refresh
                                </button>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive" style="max-height: 300px; overflow-y: auto;">
                                    <table class="table table-dark" id="logsTable">
                                        <thead>
                                            <tr>
                                                <th style="width: 30%">Timestamp</th>
                                                <th style="width: 15%">Level</th>
                                                <th style="width: 55%">Message</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% for log in recent_logs %}
                                                <tr>
                                                    <td>{{ log.timestamp }}</td>
                                                    <td>
                                                        <span class="badge {{ 'bg-info' if log.level == 'INFO' else ('bg-warning' if log.level == 'WARNING' else ('bg-danger' if log.level == 'ERROR' else 'bg-secondary')) }}">
                                                            {{ log.level }}
                                                        </span>
                                                    </td>
                                                    <td>{{ log.message }}</td>
                                                </tr>
                                            {% endfor %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Activate tab based on hash in URL
    document.addEventListener('DOMContentLoaded', function() {
        const hash = window.location.hash;
        if (hash) {
            const tab = document.querySelector(`a[href="${hash}"]`);
            if (tab) {
                tab.click();
            }
        }
        
        // Setup tab deep linking
        const tabLinks = document.querySelectorAll('.nav-link[data-bs-toggle="tab"]');
        tabLinks.forEach(tab => {
            tab.addEventListener('shown.bs.tab', function(e) {
                history.replaceState(null, null, e.target.getAttribute('href'));
            });
        });
        
        // Refresh logs
        document.getElementById('refreshLogs').addEventListener('click', function() {
            fetch('/api/logs')
                .then(response => response.json())
                .then(data => {
                    const logsTable = document.getElementById('logsTable').querySelector('tbody');
                    logsTable.innerHTML = '';
                    
                    data.logs.forEach(log => {
                        const row = document.createElement('tr');
                        
                        const timestampCell = document.createElement('td');
                        timestampCell.textContent = log.timestamp;
                        
                        const levelCell = document.createElement('td');
                        const levelBadge = document.createElement('span');
                        levelBadge.classList.add('badge');
                        
                        if (log.level === 'INFO') levelBadge.classList.add('bg-info');
                        else if (log.level === 'WARNING') levelBadge.classList.add('bg-warning');
                        else if (log.level === 'ERROR') levelBadge.classList.add('bg-danger');
                        else levelBadge.classList.add('bg-secondary');
                        
                        levelBadge.textContent = log.level;
                        levelCell.appendChild(levelBadge);
                        
                        const messageCell = document.createElement('td');
                        messageCell.textContent = log.message;
                        
                        row.appendChild(timestampCell);
                        row.appendChild(levelCell);
                        row.appendChild(messageCell);
                        
                        logsTable.appendChild(row);
                    });
                })
                .catch(error => console.error('Error refreshing logs:', error));
        });
        
        // Memory search
        document.getElementById('memory-search').addEventListener('input', function() {
            const searchTerm = this.value.toLowerCase();
            const items = document.querySelectorAll('.memory-item');
            
            items.forEach(item => {
                const title = item.querySelector('.card-title').textContent.toLowerCase();
                const content = item.querySelector('.card-text').textContent.toLowerCase();
                
                if (title.includes(searchTerm) || content.includes(searchTerm)) {
                    item.style.display = 'block';
                } else {
                    item.style.display = 'none';
                }
            });
        });
    });
</script>
{% endblock %}